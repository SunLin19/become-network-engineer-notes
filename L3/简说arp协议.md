# 简说arp协议

## arp协议概述

IP数据包常通过以太网发送。以太网设备并不识别32位IP地址：它们是以48位以太网地址传输以太网数据包的。因此，IP驱动器必须把IP目的地址转换成以太网网目的地址。在这两种地址之间存在着某种静态的或算法的映射，常常需要查看一张表。地址解析协议(Address Resolution Protocol，ARP)就是用来确定这些映象的协议。

> 摘自 [IBM - ARP协议揭密](https://www.ibm.com/developerworks/cn/linux/l-arp/index.html)

## arp工作机制

(主机A)192.168.0.111为了获得192.168.0.5(主机B)的mac地址发送arp请求包（也会将自己的mac地址告诉对方），被广播的包将被同一链路所有的主机及路由器接收解析，包中的ip地址若与主机B匹配，那么主机B就将其mac地址塞入响应包以单播的形式返回给发送方主机A。

如果每发送一个数据报都要进行一次arp请求确定mac地址，次次大量的重复广播，不利于提升网络效率；因此，通常把arp获取到mac地址作为ip对mac的映射关系记忆到一个缓存表中，当下次再向这个ip发送数据报时，直接使用缓存表中ip对应mac地址。

缓存也是有期限的，ARP缓存中的表项仅存储2分钟。一个ARP缓存表项在2分钟内被用到，则其期限再延长2分钟，直到最大生命期限10分钟为止。超过10分钟的最大期限后，ARP缓存表项将被移出，并且通过另外一个ARP请求——ARP回应交换来获得新的对应关系。

## arp报文格式略览

使用 ping 及wireshark方式，抓包查看

![](https://i.postimg.cc/PqLZjHPR/Snipaste-2019-08-07-21-17-23.png)

arp报文简要格式

![](https://i.postimg.cc/rpD3WDPF/Snipaste-2019-08-07-21-15-07.png)

ps：
* opcode表达为操作码更准确

`Padding:000000000000000000000000000000000000`：

arp以太网头14字节，arp段28字节，总共字节才42，以太网帧后面加了 18 字节的 padding（填充字符），这个以太网帧的长度是 60 字节；那为什么 ARP 请求报文的长度可以低于 60 呢？这和wireshark抓包软件本身有关，wireshark 捕获的包并不是真正发送到线路上的帧，而是发送给网卡驱动的数据。因此，如果从主机B上抓包，会发现主机A接收到的这个arp请求长度也是60字节。
