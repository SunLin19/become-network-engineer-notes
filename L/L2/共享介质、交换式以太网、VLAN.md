# 共享介质、交换式以太网、VLAN

## 网卡

每台通过网线通讯的计算机都需要安装一个硬件设备—— 网卡 ( NIC )， NIC 是 Network Interface Controller 的缩写。
* **从物理的层面看：** 网卡负责将比特流转换成电信号发送出去，同时也负责将检测到的电信号转换成比特流并接收。
* **从软件的层面看：** 发送数据时，内核协议栈负责封装以太网帧(填充目的地址、源地址、类型和数据并计算校验和)，并调用网卡驱动发送；接收数据时，负责验证目的地址、校验和并取出数据部分，交由上层协议栈处理。

> 摘自 [陈彦霏 linux-network-programming](https://linux-network-programming.readthedocs.io/zh_CN/latest/protocols/ethernet.html)

个人理解：从硬件功能描述来看网卡在执行物理层功能，从软件运行目的来说网卡是在执行数据链路层负责的功能。但传送和识别数据帧这是物理层不具有的，所以网卡还是属于数据链路层。

## 共享介质型以太网

**关键词：CSMA、CSMA/CD**

共享介质网络指由多个设备共享同一通信介质的一种网络（总线型网络）。共享介质型网络中有两种介质访问控制方式：

* 争用方式
* 令牌传递

### CSMA 载波监听多路访问

载波监听多路访问采用总线型拓扑设计，即是先抢先得的方式占用信道发送数据；若是多个主机同时发送帧，则会产生冲突的现象，造成网络拥堵。

![](https://i.postimg.cc/vTvLFdBB/UyY.jpg)

> 图摘自 [ 图解TCP/IP（第5版）- 共享介质型网络](https://www.ituring.com.cn/book/miniarticle/42608)

### 令牌传递

令牌环网的媒体接入控制机制采用的是分布式控制模式的循环方法。在令牌环网中有一个令牌(Token)沿着环形总线以逆时针方向在入网节点计算机间依次传递，令牌实际上是一个特殊格式的帧，本身并不包含信息，仅控制信道的使用，确保在同一时刻只有一个节点能够独占信道。当环上节点都空闲时，令牌绕环行进。节点计算机只有取得令牌后才能发送数据帧，因此不会发生碰撞。由于令牌在网环上是按顺序依次传递的，因此对所有入网计算机而言，访问权是公平的。

令牌在工作中有“闲”和“忙”两种状态。“闲”表示令牌没有被占用，即网中没有计算机在传送信息；“忙”表示令牌已被占用，即网中有信息正在传送。希望传送数据的计算机必须首先检测到“闲”令牌，将它置为“忙”的状态，然后在该令牌后面传送数据。当所传数据被目的节点计算机接收后，数据被从网中除去，令牌被重新置为“闲”。

令牌环网的缺点是需要维护令牌，一旦失去令牌就无法工作，需要选择专门的节点监视和管理令牌。

![](https://i.postimg.cc/0yyRdjyn/15246473058058711fc585f.gif)

> 节选自 [王刚 - 一个动画看懂网络原理之令牌环网的工作原理](http://www.wonggang.com/8151.html)

## 交换式以太网

以太网的发展很快，从单根长电缆的典型以太网结构开始演变。单根电缆存在的问题，比如找出断裂或者松动位置等连接相关的问题，驱使人们开发出一种不同类型的布线模式。在这种模式中，每个站都有一条专用电线连接到一个中央集线器。集线器只是在电气上简单地连接所有连接线，就像把它们焊接在一起。集线器本能增加容量，因为它们逻辑上等同于单根电缆的经典以太网。随着越来越多的站加入，每个站获得的固定容量共享份额下降。最终，LAN将饱和。

还有另一条出路可以处理不断增长的负载：即交换式以太网。交换式以太网的核心是一个交换机，它包含一块连接所有端口的高速背板。从外面看交换机很像集线器，它们都是一个盒子，通常拥有4-48个端口，每个端口都有一个标准的RJ-45连接器用来连接双绞电缆。交换机只把帧输出到该帧想去的端口。通过简单的插入或者拔出电缆就能完成或者删除一台机器，而且由于片状电缆或者端口通常只影响到一台机器，因此大多数错误都很容易被发现。这种配置模式仍然存在一个共享组件出现故障的问题，即交换机本身的故障：如果所有站都失去了网络连接，则更换整个交换机。

![](https://i.postimg.cc/W46WRHFc/d6b.png)

> 摘自 [百度百科-以太网](https://baike.baidu.com/item/%E4%BB%A5%E5%A4%AA%E7%BD%91/99684?fr=aladdin)

## VLAN

图中交换机1收到广播帧(ARP请求)后，会将它转发给除接收端口外的其他所有端口，也就是Flooding了。接着，交换机2收到广播帧后也会Flooding。交换机3、4、5也还会Flooding。最终ARP请求会被转发到同一网络中的所有客户机上。由此带来的后果：易造成网络瘫痪、计算机处理效率下降等诸多安全问题。

![](https://i.postimg.cc/QxxfcnXN/v2-hd.jpg)

由此就引出VLAN技术，VLAN(Virtual LAN)，翻译成中文是“虚拟局域网”，VLAN所指的LAN特指使用路由器分割的网络，也就是广播域。本来，二层交换机只能构建单一的广播域，不过使用VLAN功能后，它能够将网络分割成多个广播域。

* 削减了大面积广播域的危害
* 更易于有效化管理控制
* 提高了带宽、计算机处理效率
* 安全性得到了整体的提升

> 参考自 [知乎专栏-VLAN基础知识](https://zhuanlan.zhihu.com/p/35616289)


